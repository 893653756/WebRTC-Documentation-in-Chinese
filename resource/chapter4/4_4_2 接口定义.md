### [4.4.2 接口定义](http://w3c.github.io/webrtc-pc/#interface-definition)

The RTCPeerConnection interface presented in this section is extended by several partial interfaces throughout this specification. Notably, the RTP Media API section, which adds the APIs to send and receive MediaStreamTrack objects.

zh:本节中介绍的RTCPeerConnection接口通过本规范中的几个部分接口进行了扩展。值得注意的是，RTP Media API部分添加了API以发送和接收MediaStreamTrack对象。

```
[Constructor(optional RTCConfiguration configuration),
  Exposed=Window]
interface RTCPeerConnection : EventTarget {
  Promise<RTCSessionDescriptionInit> createOffer(optional RTCOfferOptions options);
  Promise<RTCSessionDescriptionInit> createAnswer(optional RTCAnswerOptions options);
  Promise<void> setLocalDescription(RTCSessionDescriptionInit description);
  readonly attribute RTCSessionDescription? localDescription;
  readonly attribute RTCSessionDescription? currentLocalDescription;
  readonly attribute RTCSessionDescription? pendingLocalDescription;
  Promise<void> setRemoteDescription(RTCSessionDescriptionInit description);
  readonly attribute RTCSessionDescription? remoteDescription;
  readonly attribute RTCSessionDescription? currentRemoteDescription;
  readonly attribute RTCSessionDescription? pendingRemoteDescription;
  Promise<void> addIceCandidate(RTCIceCandidateInit candidate);
  readonly attribute RTCSignalingState signalingState;
  readonly attribute RTCIceGatheringState iceGatheringState;
  readonly attribute RTCIceConnectionState iceConnectionState;
  readonly attribute RTCPeerConnectionState connectionState;
  readonly attribute boolean? canTrickleIceCandidates;
  static sequence<RTCIceServer> getDefaultIceServers();
  RTCConfiguration getConfiguration();
  void setConfiguration(RTCConfiguration configuration);
  void close();
  attribute EventHandler onnegotiationneeded;
  attribute EventHandler onicecandidate;
  attribute EventHandler onicecandidateerror;
  attribute EventHandler onsignalingstatechange;
  attribute EventHandler oniceconnectionstatechange;
  attribute EventHandler onicegatheringstatechange;
  attribute EventHandler onconnectionstatechange;
};

```

##### 构造函数

*`RTCPeerConnection`*

See the RTCPeerConnection constructor algorithm. 
zh: 请参阅 [RTCPeerConnection 构造函数算法](/resource/chapter4/4_4_1_1%20构造函数.md)。

##### 属性

**`localDescription`** of type RTCSessionDescription, readonly, nullable:
**`localDescription`**类型 RTCSessionDescription，readonly，nullable

The localDescription attribute MUST return [[PendingLocalDescription]] if it is not null and otherwise it MUST return [[CurrentLocalDescription]].

zh:如果localDescription属性不为null，则它必须返回[[PendingLocalDescription]]，否则它必须返回[[CurrentLocalDescription]]。

Note that [[CurrentLocalDescription]].sdp and [[PendingLocalDescription]].sdp need not be string-wise identical to the SDP value passed to the corresponding setLocalDescription call (i.e. SDP may be parsed and reformatted, and ICE candidates may be added).

zh:注意[[CurrentLocalDescription]]。sdp和[[PendingLocalDescription]]。sdp不需要与传递给相应setLocalDescription调用的SDP值完全相同（即SDP可以被解析和重新格式化，并且可以添加ICE候选者） 。

**`currentLocalDescription`** of type RTCSessionDescription, readonly, nullable:

**`currentLocalDescription`**类型为RTCSessionDescription，readonly，nullable

The currentLocalDescription attribute MUST return [[CurrentLocalDescription]].

zh:currentLocalDescription属性必须返回[[CurrentLocalDescription]]。

It represents the local description that was successfully negotiated the last time the RTCPeerConnection transitioned into the stable state plus any local candidates that have been generated by the ICE Agent since the offer or answer was created.

zh:它表示上次RTCPeerConnection转换为稳定状态时成功协商的本地描述，以及自创建商品或答案以来ICE代理生成的任何本地候选项。

**`pendingLocalDescription`** of type RTCSessionDescription, readonly, nullable:

**`pendingLocalDescription`**类型为RTCSessionDescription，readonly，nullable

The pendingLocalDescription attribute MUST return [[PendingLocalDescription]].

zh:pendingLocalDescription属性必须返回[[PendingLocalDescription]]。

It represents a local description that is in the process of being negotiated plus any local candidates that have been generated by the ICE Agent since the offer or answer was created. If the RTCPeerConnection is in the stable state, the value is null.

zh:它表示正在协商的本地描述以及自创建提议或答案以来ICE代理生成的任何本地候选人。如果RTCPeerConnection处于稳定状态，则该值为空。

**`remoteDescription`** of type RTCSessionDescription, readonly, nullable:

**`remoteDescription`**类型RTCSessionDescription，readonly，nullable

The remoteDescription attribute MUST return [[PendingRemoteDescription]] if it is not null and otherwise it MUST return [[CurrentRemoteDescription]].

zh:remoteDescription属性必须返回[[PendingRemoteDescription]]，如果它不为null，否则它必须返回[[CurrentRemoteDescription]]。

Note that [[CurrentRemoteDescription]].sdp and [[PendingRemoteDescription]].sdp need not be string-wise identical to the SDP value passed to the corresponding setRemoteDescription call (i.e. SDP may be parsed and reformatted, and ICE candidates may be added).

zh:注意[[CurrentRemoteDescription]]。sdp和[[PendingRemoteDescription]]。sdp不需要与传递给相应的setRemoteDescription调用的SDP值完全相同（即SDP可以被解析和重新格式化，并且可以添加ICE候选者） 。

**`currentRemoteDescription`** of type RTCSessionDescription, readonly, nullable:

**`currentRemoteDescription`**类型为RTCSessionDescription，readonly，nullable

The currentRemoteDescription attribute MUST return [[CurrentRemoteDescription]].

zh:currentRemoteDescription属性必须返回[[CurrentRemoteDescription]]。

It represents the last remote description that was successfully negotiated the last time the RTCPeerConnection transitioned into the stable state plus any remote candidates that have been supplied via addIceCandidate() since the offer or answer was created.

zh:它表示上次RTCPeerConnection转换为稳定状态时成功协商的最后一个远程描述，以及自创建商品或答案以来通过addIceCandidate（）提供的任何远程候选。

**`pendingRemoteDescription`** of type RTCSessionDescription, readonly, nullable:

**`pendingRemoteDescription`**类型RTCSessionDescription，readonly，nullable

The pendingRemoteDescription attribute MUST return [[PendingRemoteDescription]].

zh:pendingRemoteDescription属性必须返回[[PendingRemoteDescription]]。

It represents a remote description that is in the process of being negotiated, complete with any remote candidates that have been supplied via addIceCandidate() since the offer or answer was created. If the RTCPeerConnection is in the stable state, the value is null.

zh:它表示正在协商过程中的远程描述，包括自创建商品或答案以来通过addIceCandidate（）提供的任何远程候选项。如果RTCPeerConnection处于稳定状态，则该值为空。

**`signalingState`** of type RTCSignalingState, readonly:

zh:TRANSPCS类型为RTCSignalingState的signalingState


The signalingState attribute MUST return the RTCPeerConnection object's signaling state. 

zh: signalingState属性必须返回RTCPeerConnection对象的信令状态。


**`iceGatheringState`** of type RTCIceGatheringState, readonly:

**`iceGatheringState`**类型为RTCIceGatheringState，只读

The iceGatheringState attribute MUST return the ICE gathering state of the RTCPeerConnection instance. 

zh: iceGatheringState属性必须返回RTCPeerConnection实例的ICE收集状态。

**`iceConnectionState`** of type RTCIceConnectionState, readonly:

**`RTCIceConnectionState`**类型的iceConnectionState，只读

The iceConnectionState attribute MUST return the ICE connection state of the RTCPeerConnection instance. 

zh: iceConnectionState属性必须返回RTCPeerConnection实例的ICE连接状态。

**`connectionState`** of type RTCPeerConnectionState, readonly:

zh:类型为RTCPeerConnectionState的connectionState，只读

The connectionState attribute MUST return the connection state of the RTCPeerConnection instance. 

zh: connectionState属性必须返回RTCPeerConnection实例的连接状态。

**`canTrickleIceCandidates`** of type boolean, readonly, nullable:

zh:canTrickleIceCandidates类型为boolean，readonly，nullable

The canTrickleIceCandidates attribute indicates whether the remote peer is able to accept trickled ICE candidates [TRICKLE-ICE]. The value is determined based on whether a remote description indicates support for trickle ICE, as defined in [JSEP] (section 4.1.15.). Prior to the completion of setRemoteDescription, this value is null. 

zh: canTrickleIceCandidates属性指示远程对等方是否能够接受滴滤的ICE候选[TRICKLE-ICE]。该值是根据远程描述是否表示支持涓流ICE确定的，如[JSEP]（第4.1.15节）中所定义。在完成setRemoteDescription之前，此值为null。

**`onnegotiationneeded`** of type EventHandler:

zh:onnegotiationneeded类型EventHandler

The event type of this event handler is negotiationneeded.

zh:此事件处理程序的事件类型是negotiationneeded。


**`onicecandidate`** of type EventHandler:

zh:eventHandler类型的onicecandidate

The event type of this event handler is icecandidate.

zh:此事件处理程序的事件类型是icecandidate。

**`onicecandidateerror`** of type EventHandler:

zh:eventHandler类型的onicecandidateerror

The event type of this event handler is icecandidateerror.

zh:此事件处理程序的事件类型是icecandidateerror。

**`onsignalingstatechange`** of type EventHandler:

zh:onSignalingstate类型EventHandler的更改

The event type of this event handler is signalingstatechange.

zh:此事件处理程序的事件类型是signalingstatechange。

**`oniceconnectionstatechange`** of type EventHandler:

zh:eventHandler类型的oniceconnectionstatechange

The event type of this event handler is iceconnectionstatechange

zh:此事件处理程序的事件类型是iceconnectionstatechange

**`onicegatheringstatechange`** of type EventHandler:

zh:eventHandler类型的onicegatheringstatechange

The event type of this event handler is icegatheringstatechange.

zh:此事件处理程序的事件类型是icegatheringstatechange。

**`onconnectionstatechange`** of type EventHandler:

zh:eventHandler类型的onconnectionstatechange

The event type of this event handler is connectionstatechange.

zh:此事件处理程序的事件类型是connectionstatechange。

##### 方法

`createOffer`

The createOffer method generates a blob of SDP that contains an RFC 3264 offer with the supported configurations for the session, including descriptions of the local MediaStreamTracks attached to this RTCPeerConnection, the codec/RTP/RTCP capabilities supported by this implementation, and parameters of the ICE agent and the DTLS connection. The options parameter may be supplied to provide additional control over the offer generated.

zh:createOffer方法生成一个SDP blob，其中包含RFC 3264商品，其中包含会话支持的配置，包括附加到此RTCPeerConnection的本地MediaStreamTracks的说明，此实现支持的编解码器/ RTP / RTCP功能以及ICE的参数代理和DTLS连接。可以提供选项参数以提供对所生成的报价的额外控制。

If a system has limited resources (e.g. a finite number of decoders), createOffer needs to return an offer that reflects the current state of the system, so that setLocalDescription will succeed when it attempts to acquire those resources. The session descriptions MUST remain usable by setLocalDescription without causing an error until at least the end of the fulfillment callback of the returned promise.

zh:如果系统具有有限的资源（例如，有限数量的解码器），则createOffer需要返回反映系统当前状态的商品，以便setLocalDescription在尝试获取这些资源时成功。会话描述必须仍然可以通过setLocalDescription保持可用，而不会导致错误，直到至少返回的promise的履行回调结束。

Creating the SDP MUST follow the appropriate process for generating an offer described in [JSEP]. As an offer, the generated SDP will contain the full set of codec/RTP/RTCP capabilities supported or preferred by the session (as opposed to an answer, which will include only a specific negotiated subset to use). In the event createOffer is called after the session is established, createOffer will generate an offer that is compatible with the current session, incorporating any changes that have been made to the session since the last complete offer-answer exchange, such as addition or removal of tracks. If no changes have been made, the offer will include the capabilities of the current local description as well as any additional capabilities that could be negotiated in an updated offer.

zh:创建SDP必须遵循适当的流程来生成[JSEP]中描述的商品。作为要约，生成的SDP将包含会话支持或优选的全套编解码器/ RTP / RTCP功能（而不是答案，其将仅包括要使用的特定协商子集）。如果在建立会话后调用createOffer，createOffer将生成与当前会话兼容的商品，其中包含自上次完成商品 - 应答交换以来对会话所做的任何更改，例如添加或删除轨道。如果未进行任何更改，则要约将包括当前本地描述的功能以及可在更新的要约中协商的任何其他功能。

The generated SDP will also contain the ICE agent's usernameFragment, password and ICE options (as defined in [ICE], Section 14) and may also contain any local candidates that have been gathered by the agent.

zh:生成的SDP还将包含ICE代理的usernameFragment，密码和ICE选项（在[ICE]，第14节中定义），还可以包含代理收集的任何本地候选。

The certificates value in configuration for the RTCPeerConnection provides the certificates configured by the application for the RTCPeerConnection. These certificates, along with any default certificates are used to produce a set of certificate fingerprints. These certificate fingerprints are used in the construction of SDP and as input to requests for identity assertions.

zh:RTCPeerConnection的配置中的证书值提供了应用程序为RTCPeerConnection配置的证书。这些证书以及任何默认证书用于生成一组证书指纹。这些证书指纹用于构建SDP和作为身份断言请求的输入。

If the RTCPeerConnection is configured to generate Identity assertions by calling setIdentityProvider, then the session description SHALL contain an appropriate assertion.

zh:如果RTCPeerConnection配置为通过调用setIdentityProvider生成Identity断言，则会话描述应包含适当的断言。

The process of generating an SDP exposes a subset of the media capabilities of the underlying system, which provides generally persistent cross-origin information on the device. It thus increases the fingerprinting surface of the application. In privacy-sensitive contexts, browsers can consider mitigations such as generating SDP matching only a common subset of the capabilities.

zh:生成SDP的过程暴露了底层系统的媒体功能的子集，其在设备上提供通常持久的跨源信息。因此，它增加了应用的指纹表面。在隐私敏感的上下文中，浏览器可以考虑缓解，例如仅生成SDP匹配功能的公共子集。

When the method is called, the user agent MUST run the following steps:

zh:调用该方法时，用户代理必须执行以下步骤：

1. Let connection be the RTCPeerConnection object on which the method was invoked. 
zh: 让connection成为调用方法的RTCPeerConnection对象。

2. If connection's [[IsClosed]] slot is true, return a promise rejected with a newly created InvalidStateError. 
zh: 如果connection的[[IsClosed]] slot为true，则返回使用新创建的InvalidStateError拒绝的promise。

3. If connection is configured with an identity provider, then begin the identity assertion request process if it has not already begun. 
zh: 如果使用身份提供程序配置连接，则在尚未开始的情况下开始身份声明请求过程。

4. Return the result of enqueuing the following steps to connection's operation queue:
zh:将以下步骤的结果返回到连接的操作队列：

	1. Let p be a new promise. 
zh: 让p成为新的承诺。

	2. In parallel, begin the steps to create an offer, given p. 
zh: 同时，在给定p的情况下，开始创建报价的步骤。

	3.  Return p. 
zh: 返回p。

The steps to create an offer given a promise p are as follows:

zh:在给定承诺p的情况下创建要约的步骤如下：

1. If connection was not constructed with a set of certificates, and one has not yet been generated, wait for it to be generated. 
zh: 如果未使用一组证书构建连接，并且尚未生成一个证书，请等待生成。

2. Let provider be connection's currently configured identity provider if one has been configured, or null otherwise. 
zh: 如果已配置提供者，则提供者是连接的当前配置身份提供者，否则为null。

3. If provider is non-null, wait for the identity assertion request process to complete. 
zh: 如果provider为非null，则等待身份断言请求过程完成。

4. If provider was unable to produce an identity assertion, reject p with a newly created NotReadableError and abort these steps. 
zh: 如果提供程序无法生成标识声明，请使用新创建的NotReadableError拒绝p并中止这些步骤。

5. Inspect the system state to determine the currently available resources as necessary for generating the offer, as described in [JSEP] (section 4.1.6.). 
zh: 检查系统状态以确定生成要约所需的当前可用资源，如[JSEP]（第4.1.6节）中所述。

6. If this inspection failed for any reason, reject p with a newly created OperationError and abort these steps. 
zh: 如果此检查因任何原因失败，请使用新创建的OperationError拒绝p并中止这些步骤。

7. Queue a task that runs the final steps to create an offer, given p. 
zh: 在给定p的情况下，对运行最终步骤以创建商品的任务进行排队。

The final steps to create an offer given a promise p are as follows:

zh:给出承诺p创建要约的最后步骤如下：

1. If connection's [[IsClosed]] slot is true, then abort these steps. 
zh: 如果connection的[[IsClosed]] slot为true，则中止这些步骤。

2. If connection was modified in such a way that additional inspection of the system state is necessary, or if its configured indentity provider is no longer provider, then in parallel begin the steps to create an offer again, given p, and abort these steps.
zh:如果以这样的方式修改连接，即需要对系统状态进行额外检查，或者如果其配置的indentity提供程序不再是提供者，则并行开始执行再次创建商品的步骤，给定p，并中止这些步骤。

	NOTE：This may be necessary if, for example, createOffer was called when only an audio RTCRtpTransceiver was added to connection, but while performing the steps to create an offer in parallel, a video RTCRtpTransceiver was added, requiring additional inspection of video system resources.zh:NOTE：如果仅在连接中添加了音频RTCRtpTransceiver时调用了createOffer，但在执行并行创建商品的步骤时，可能需要添加视频RTCRtpTransceiver，这需要额外检查视频系统资源。

3. Given the information that was obtained from previous inspection, the current state of connection and its RTCRtpTransceivers, and the identity assertion from provider (if non-null), generate an SDP offer, sdpString, as described in [JSEP] (section 5.2.).
zh:给定从先前检查获得的信息，当前连接状态及其RTCRtpTransceivers，以及来自提供者的身份断言（如果非空），生成SDP提议sdpString，如[JSEP]（第5.2节）中所述。

	1. As described in [BUNDLE] (Section 7), if bundling is used (see RTCBundlePolicy) an offerer tagged m= section must be selected in order to negotiate a BUNDLE group. The user agent MUST choose the m= section that corresponds to the first non-stopped transceiver in the set of transceivers as the offerer tagged m= section. This allows the remote endpoint to predict which transceiver is the offerer tagged m= section without having to parse the SDP.
zh: 如[捆绑]（第7节）中所述，如果使用捆绑（请参阅RTCBundlePolicy），则必须选择标记为m = section的提议者才能协商BUNDLE组。用户代理必须选择m =部分，该部分对应于收发器集合中的第一个不停止的收发器，作为提供者标记的m =部分。这允许远程端点预测哪个收发器是提供者标记的m =部分而不必解析SDP。

	2. The codec preferences of an m= section's associated transceiver is said to be the value of the RTCRtpTranceiver's [[PreferredCodecs]] slot with the following filtering applied (or said not to be set if [[PreferredCodecs]] is empty):
zh:m =段的相关收发器的编解码器首选项被称为RTCRtpTranceiver的[[PreferredCodecs]]插槽的值，应用了以下过滤（或者如果[[PreferredCodecs]]为空则表示不设置）：

		1. If the direction is "sendrecv", exclude any codecs not included in the intersection of RTCRtpSender.getCapabilities(kind).codecs and RTCRtpReceiver.getCapabilities(kind).codecs. 
zh: 如果方向是“sendrecv”，则排除RTCRtpSender.getCapabilities（kind）.codecs和RTCRtpReceiver.getCapabilities（kind）.codecs交集中未包含的任何编解码器。

		2. If the direction is "sendonly", exclude any codecs not included in RTCRtpSender.getCapabilities(kind).codecs. 
zh: 如果方向是“sendonly”，则排除RTCRtpSender.getCapabilities（kind）.codecs中未包含的任何编解码器。

		3. If the direction is "recvonly", exclude any codecs not included in RTCRtpReceiver.getCapabilities(kind).codecs. 
zh: 如果方向是“recvonly”，则排除RTCRtpReceiver.getCapabilities（kind）.codecs中未包含的任何编解码器。

	The filtering MUST NOT change the order of the codec preferences.
zh:过滤绝不能改变编解码器首选项的顺序。


4. Let offer be a newly created RTCSessionDescriptionInit dictionary with its type member initialized to the string "offer" and its sdp member initialized to sdpString. 
zh: 让offer成为一个新创建的RTCSessionDescriptionInit字典，其类型成员初始化为字符串“offer”，其sdp成员初始化为sdpString。

5. Set the [[LastOffer]] internal slot to sdpString. 
zh:将[[LastOffer]]内部插槽设置为sdpString。

6. Resolve p with offer. 
zh: 用报价解决p。

`createAnswer`

The createAnswer method generates an [SDP] answer with the supported configuration for the session that is compatible with the parameters in the remote configuration. Like createOffer, the returned blob of SDP contains descriptions of the local MediaStreamTracks attached to this RTCPeerConnection, the codec/RTP/RTCP options negotiated for this session, and any candidates that have been gathered by the ICE Agent. The options parameter may be supplied to provide additional control over the generated answer.
zh:createAnswer方法使用支持的会话配置生成[SDP]答案，该配置与远程配置中的参数兼容。与createOffer一样，返回的SDP blob包含附加到此RTCPeerConnection的本地MediaStreamTracks的描述，为此会话协商的编解码器/ RTP / RTCP选项，以及ICE代理收集的任何候选项。可以提供选项参数以提供对生成的答案的附加控制。

Like createOffer, the returned description SHOULD reflect the current state of the system. The session descriptions MUST remain usable by setLocalDescription without causing an error until at least the end of the fulfillment callback of the returned promise.
zh:与createOffer一样，返回的描述应该反映系统的当前状态。会话描述必须仍然可以通过setLocalDescription保持可用，而不会导致错误，直到至少返回的promise的履行回调结束。

As an answer, the generated SDP will contain a specific codec/RTP/RTCP configuration that, along with the corresponding offer, specifies how the media plane should be established. The generation of the SDP MUST follow the appropriate process for generating an answer described in [JSEP].
zh:作为答案，生成的SDP将包含特定的编解码器/ RTP / RTCP配置，该配置与相应的提议一起指定应如何建立媒体平面。 SDP的生成必须遵循生成[JSEP]中描述的答案的适当过程。

The generated SDP will also contain the ICE agent's usernameFragment, password and ICE options (as defined in [ICE], Section 14) and may also contain any local candidates that have been gathered by the agent.
zh:生成的SDP还将包含ICE代理的usernameFragment，密码和ICE选项（在[ICE]，第14节中定义），还可以包含代理收集的任何本地候选。

The certificates value in configuration for the RTCPeerConnection provides the certificates configured by the application for the RTCPeerConnection. These certificates, along with any default certificates are used to produce a set of certificate fingerprints. These certificate fingerprints are used in the construction of SDP and as input to requests for identity assertions.
zh:RTCPeerConnection的配置中的证书值提供了应用程序为RTCPeerConnection配置的证书。这些证书以及任何默认证书用于生成一组证书指纹。这些证书指纹用于构建SDP和作为身份断言请求的输入。

An answer can be marked as provisional, as described in [JSEP] (section 4.1.8.1.), by setting the type to "pranswer".
zh:通过将类型设置为“pranswer”，可以将答案标记为临时，如[JSEP]（第4.1.8.1节）中所述。

If the RTCPeerConnection is configured to generate Identity assertions by calling setIdentityProvider, then the session description SHALL contain an appropriate assertion.
zh:如果RTCPeerConnection配置为通过调用setIdentityProvider生成Identity断言，则会话描述应包含适当的断言。

When the method is called, the user agent MUST run the following steps:
zh:调用该方法时，用户代理必须执行以下步骤：

1. Let connection be the RTCPeerConnection object on which the method was invoked. 
zh: 让connection成为调用方法的RTCPeerConnection对象。

2. If connection's [[IsClosed]] slot is true, return a promise rejected with a newly created InvalidStateError. 
zh: 如果connection的[[IsClosed]] slot为true，则返回使用新创建的InvalidStateError拒绝的promise。

3. If connection is configured with an identity provider, then begin the identity assertion request process if it has not already begun. 
zh: 如果使用身份提供程序配置连接，则在尚未开始的情况下开始身份声明请求过程。

4. Return the result of enqueuing the following steps to connection's operation queue:
zh:将以下步骤的结果返回到连接的操作队列：

	1. If connection's signaling state is neither "have-remote-offer" nor "have-local-pranswer", return a promise rejected with a newly created InvalidStateError.
zh: 如果连接的信令状态既不是“have-remote-offer”也不是“have-local-pranswer”，则返回使用新创建的InvalidStateError拒绝的promise。

	2. Let p be a new promise.
zh: 让p成为新的承诺。

	3. In parallel, begin the steps to create an answer, given p.
zh: 同时，在给定p的情况下，开始创建答案的步骤。

	4. Return p.
zh: 返回p。


The steps to create an answer given a promise p are as follows:
zh:给出承诺p创建答案的步骤如下：

1. If connection was not constructed with a set of certificates, and one has not yet been generated, wait for it to be generated.
zh: 如果未使用一组证书构建连接，并且尚未生成一个证书，请等待生成。

2. Let provider be connection's currently configured identity provider if one has been configured, or null otherwise.
zh: 如果已配置提供者，则提供者是连接的当前配置身份提供者，否则为null。

3. If provider is non-null, wait for the identity assertion request process to complete.
zh: 如果provider为非null，则等待身份断言请求过程完成。

4. If provider was unable to produce an identity assertion, reject p with a newly created NotReadableError and abort these steps.
zh: 如果提供程序无法生成标识声明，请使用新创建的NotReadableError拒绝p并中止这些步骤。

5. Inspect the system state to determine the currently available resources as necessary for generating the answer, as described in [JSEP] (section 4.1.7.).
zh: 检查系统状态以确定生成答案所需的当前可用资源，如[JSEP]（第4.1.7节）中所述。

6. If this inspection failed for any reason, reject p with a newly created OperationError and abort these steps.
zh: 如果此检查因任何原因失败，请使用新创建的OperationError拒绝p并中止这些步骤。

7. Queue a task that runs the final steps to create an answer, given p.
zh: 在给定p的情况下，对运行最终步骤以创建答案的任务进行排队。

The final steps to create an answer given a promise p are as follows:
zh:给出承诺p创建答案的最后步骤如下：

1. If connection's [[IsClosed]] slot is true, then abort these steps.
zh: 如果connection的[[IsClosed]] slot为true，则中止这些步骤。

2. If connection was modified in such a way that additional inspection of the system state is necessary, or if its configured indentity provider is no longer provider, then in parallel begin the steps to create an answer again, given p, and abort these steps.
zh:如果以这样的方式修改连接，即需要对系统状态进行额外检查，或者如果其配置的indentity提供程序不再是提供者，那么并行开始步骤再次创建答案，给定p，并中止这些步骤。
	

	NOTE：This may be necessary if, for example, createAnswer was called when an RTCRtpTransceiver's direction was "recvonly", but while performing the steps to create an answer in parallel, the direction was changed to "sendrecv", requiring additional inspection of video encoding resources.
	NOTE：如果在RTCRtpTransceiver的方向是“recvonly”时调用createAnswer，则可能需要这样做，但在执行并行创建答案的步骤时，方向已更改为“sendrecv”，需要额外检查视频编码资源。
	
3. Given the information that was obtained from previous inspection and the current state of connection and its RTCRtpTransceivers, and the identity assertion from provider (if non-null), generate an SDP answer, sdpString, as described in [JSEP] (section 5.3.).
	zh:给定从先前检查获得的信息以及当前连接状态及其RTCRtpTransceivers，以及来自提供者的身份断言（如果非空），生成SDP答案sdpString，如[JSEP]（第5.3节）中所述。 。

	1. The codec preferences of an m= section's associated transceiver is said to be the value of the RTCRtpTranceiver's [[PreferredCodecs]] slot with the following filtering applied (or said not to be set if [[PreferredCodecs]] is empty):
	zh:m =段的相关收发器的编解码器首选项被称为RTCRtpTranceiver的[[PreferredCodecs]]插槽的值，应用了以下过滤（或者如果[[PreferredCodecs]]为空则表示不设置）：
		
		1. If the direction is "sendrecv", exclude any codecs not included in the intersection of RTCRtpSender.getCapabilities(kind).codecs and RTCRtpReceiver.getCapabilities(kind).codecs.
zh: 如果方向是“sendrecv”，则排除RTCRtpSender.getCapabilities（kind）.codecs和RTCRtpReceiver.getCapabilities（kind）.codecs交集中未包含的任何编解码器。

		2. If the direction is "sendonly", exclude any codecs not included in RTCRtpSender.getCapabilities(kind).codecs.
zh: 如果方向是“sendonly”，则排除RTCRtpSender.getCapabilities（kind）.codecs中未包含的任何编解码器。

		3. If the direction is "recvonly", exclude any codecs not included in RTCRtpReceiver.getCapabilities(kind).codecs.
zh: 如果方向是“recvonly”，则排除RTCRtpReceiver.getCapabilities（kind）.codecs中未包含的任何编解码器。

	The filtering MUST NOT change the order of the codec preferences.
zh:过滤绝不能改变编解码器首选项的顺序。

4. Let answer be a newly created RTCSessionDescriptionInit dictionary with its type member initialized to the string "answer" and its sdp member initialized to sdpString.
zh: 让我们回答一个新创建的RTCSessionDescriptionInit字典，其类型成员初始化为字符串“answer”，其sdp成员初始化为sdpString。

5. Set the [[LastAnswer]] internal slot to sdpString.
zh:将[[LastAnswer]]内部插槽设置为sdpString。

6. Resolve p with answer.
zh: 用答案解决p。

`setLocalDescription`

The setLocalDescription method instructs the RTCPeerConnection to apply the supplied RTCSessionDescriptionInit as the local description.
zh:setLocalDescription方法指示RTCPeerConnection将提供的RTCSessionDescriptionInit应用为本地描述。

This API changes the local media state. In order to successfully handle scenarios where the application wants to offer to change from one media format to a different, incompatible format, the RTCPeerConnection MUST be able to simultaneously support use of both the current and pending local descriptions (e.g. support codecs that exist in both descriptions) until a final answer is received, at which point the RTCPeerConnection can fully adopt the pending local description, or rollback to the current description if the remote side rejected the change.
zh:此API更改本地媒体状态。为了成功处理应用程序想要提供的从一种媒体格式更改为不同的不兼容格式的场景，RTCPeerConnection必须能够同时支持使用当前和未决的本地描述（例如，支持两者中存在的编解码器）描述）直到收到最终答案，此时RTCPeerConnection可以完全采用待处理的本地描述，或者如果远程端拒绝更改，则回滚到当前描述。

As noted in [JSEP] (section 5.4.) the SDP returned from createOffer or createAnswer MUST NOT be changed before passing it to setLocalDescription. As a result, when the method is invoked, the user agent MUST run the following steps:
zh:如[JSEP]（第5.4节）中所述，从createOffer或createAnswer返回的SDP在传递给setLocalDescription之前不得更改。因此，当调用该方法时，用户代理必须运行以下步骤：

1. Let description be the first argument to setLocalDescription.
zh:让description成为setLocalDescription的第一个参数。

2. If description.sdp is the empty string and description.type is "answer" or "pranswer", set description.sdp to the value of connection's [[LastAnswer]] slot.
zh:如果description.sdp为空字符串且description.type为“answer”或“pranswer”，则将description.sdp设置为connection [[LastAnswer]]插槽的值。

3. If description.sdp is the empty string and description.type is "offer", set description.sdp to the value of connection's [[LastOffer]] slot.
zh:如果description.sdp为空字符串且description.type为“offer”，则将description.sdp设置为connection [[LastOffer]]插槽的值。

4. Return the result of setting the RTCSessionDescription indicated by description.
zh:返回设置描述所指示的RTCSessionDescription的结果。

NOTE:As noted in [JSEP] (section 5.9.), calling this method may trigger the ICE candidate gathering process by the ICE Agent.
zh:如[JSEP]（第5.9节）所述，调用此方法可能会触发ICE代理的ICE候选人收集过程。

`setRemoteDescription`

The setRemoteDescription method instructs the RTCPeerConnection to apply the supplied RTCSessionDescriptionInit as the remote offer or answer. This API changes the local media state.

zh:setRemoteDescription方法指示RTCPeerConnection将提供的RTCSessionDescriptionInit应用为远程提供或答案。此API更改本地媒体状态。

When the method is invoked, the user agent MUST return the result of setting the RTCSessionDescription indicated by the method's first argument.

zh:调用该方法时，用户代理必须返回设置方法的第一个参数指示的RTCSessionDescription的结果。

In addition, a remote description is processed to determine and verify the identity of the peer.

zh:此外，处理远程描述以确定和验证对等体的身份。

If an a=identity attribute is present in the session description, the browser validates the identity assertion..

zh:如果会话描述中存在a = identity属性，则浏览器验证标识声明。

If the peerIdentity configuration is applied to the RTCPeerConnection, this establishes a target peer identity of the provided value. Alternatively, if the RTCPeerConnection has previously authenticated the identity of the peer (that is, the peerIdentity promise is resolved), then this also establishes a target peer identity.

zh:如果peerIdentity配置应用于RTCPeerConnection，则会建立所提供值的目标对等体标识。或者，如果RTCPeerConnection先前已经验证了对等体的身份（即，解析了peerIdentity promise），那么这也建立了目标对等体身份。

The target peer identity cannot be changed once set.

zh:设置后，目标对等身份不能更改。

If a target peer identity is set, then the identity validation MUST be completed before the promise returned setRemoteDescription is resolved. If identity validation fails, then the promise returned by setRemoteDescription is rejected.

zh:如果设置了目标对等体标识，则必须在声明返回setRemoteDescription解析之前完成身份验证。如果身份验证失败，则会拒绝setRemoteDescription返回的承诺。

If there is no target peer identity, then setRemoteDescription does not await the completion of identity validation.

zh:如果没有目标对等体标识，则setRemoteDescription不会等待完成身份验证。

`addIceCandidate`

The addIceCandidate method provides a remote candidate to the ICE Agent. This method can also be used to indicate the end of remote candidates when called with an empty string for the candidate member. The only members of the argument used by this method are candidate, sdpMid, sdpMLineIndex, and usernameFragment; the rest are ignored. When the method is invoked, the user agent MUST run the following steps:
zh:addIceCandidate方法为ICE代理提供远程候选。当用候选成员的空字符串调用时，此方法还可用于指示远程候选者的结束。此方法使用的参数的唯一成员是candidate，sdpMid，sdpMLineIndex和usernameFragment;其余的都被忽略了。调用该方法时，用户代理必须运行以下步骤：

1. Let candidate be the method's argument.
zh: 让候选人成为方法的论点。

2. Let connection be the RTCPeerConnection object on which the method was invoked.
zh: 让connection成为调用方法的RTCPeerConnection对象。

3. If candidate.candidate is not an empty string and both candidate.sdpMid and candidate.sdpMLineIndex are null, return a promise rejected with a newly created TypeError.
zh: 如果candidate.candidate不是空字符串且candidate.sdpMid和candidate.sdpMLineIndex都为null，则返回使用新创建的TypeError拒绝的promise。

4. Return the result of enqueuing the following steps to connection's operation queue:
zh:将以下步骤的结果返回到连接的操作队列：

	1. If remoteDescription is null return a promise rejected with a newly created InvalidStateError.
zh: 如果remoteDescription为null，则返回使用新创建的InvalidStateError拒绝的承诺。

	2. Let p be a new promise.
zh: 让p成为新的承诺。

	3. If candidate.sdpMid is not null, run the following steps:
zh: 如果candidate.sdpMid不为null，请运行以下步骤：

		1. If candidate.sdpMid is not equal to the mid of any media description in remoteDescription, reject p with a newly created OperationError and abort these steps.
zh: 如果candidate.sdpMid不等于remoteDescription中任何媒体描述的中间部分，则使用新创建的OperationError拒绝p并中止这些步骤。

	4. Else, if candidate.sdpMLineIndex is not null, run the following steps:
zh: 否则，如果candidate.sdpMLineIndex不为null，请运行以下步骤：

		1. If candidate.sdpMLineIndex is equal to or larger than the number of media descriptions in remoteDescription, reject p with a newly created OperationError and abort these steps.
zh: 如果candidate.sdpMLineIndex等于或大于remoteDescription中的媒体描述数，则使用新创建的OperationError拒绝p并中止这些步骤。
zh: 如果candidate.usernameFragment既不是未定义也不是null，并且不等于应用的远程描述的相应媒体描述中存在的任何用户名片段，则使用新创建的OperationError拒绝p并中止这些步骤。

	5. If candidate.usernameFragment is neither undefined nor null, and is not equal to any username fragment present in the corresponding media description of an applied remote description, reject p with a newly created OperationError and abort these steps.
zh:如果candidate.usernameFragment既不是未定义也不是null，并且不等于应用的远程描述的相应媒体描述中存在的任何用户名片段，则使用新创建的OperationError拒绝p并中止这些步骤。

	6. In parallel, add the ICE candidate candidate as described in [JSEP] (section 4.1.17.). Use candidate.usernameFragment to identify the ICE generation; if usernameFragment is null, process the candidate for the most recent ICE generation. If candidate.candidate is an empty string, process candidate as an end-of-candidates indication for the corresponding media description and ICE candidate generation. If both candidate.sdpMid and candidate.sdpMLineIndex are null, then this applies to all media descriptions.
zh:同时，按照[JSEP]（第4.1.17节）中的描述添加ICE候选候选者。使用candidate.usernameFragment来标识ICE生成;如果usernameFragment为null，则处理最近ICE生成的候选项。如果candidate.candidate是空字符串，则将候选处理作为对应的媒体描述和ICE候选生成的候选结束指示。如果candidate.sdpMid和candidate.sdpMLineIndex都为null，则这适用于所有媒体描述。
		1. If candidate could not be successfully added the user agent MUST queue a task that runs the following steps:
		zh:如果无法成功添加候选者，则用户代理必须对运行以下步骤的任务进行排队：

			1. If connection's [[IsClosed]] slot is true, then abort these steps.
zh: 如果connection的[[IsClosed]] slot为true，则中止这些步骤。

			2. Reject p with a newly created OperationError and abort these steps.
zh: 使用新创建的OperationError拒绝p并中止这些步骤。

		2. If candidate is applied successfully, the user agent MUST queue a task that runs the following steps:
		zh:如果候选成功应用，则用户代理必须对运行以下步骤的任务进行排队：

			1. If connection's [[IsClosed]] slot is true, then abort these steps.
zh: 如果connection的[[IsClosed]] slot为true，则中止这些步骤。

			2. If connection.[[PendingRemoteDescription]] is not null, and represents the ICE generation for which candidate was processed, add candidate to the connection.[[PendingRemoteDescription]].sdp.
zh: 如果connection。[[PendingRemoteDescription]]不为null，并且表示处理候选的ICE生成，则将候选添加到连接。[[PendingRemoteDescription]]。sdp。

			3. If connection.[[CurrentRemoteDescription]] is not null, and represents the ICE generation for which candidate was processed, add candidate to the connection.[[CurrentRemoteDescription]].sdp.
zh: 如果connection。[[CurrentRemoteDescription]]不为null，并且表示处理候选的ICE生成，则将候选添加到连接。[[CurrentRemoteDescription]]。sdp。

			4. Resolve p with undefined.
zh: 使用undefined解析p。

	7. Return p.
zh:返回p。
		
NOTE:Due to WebIDL processing, addIceCandidate(null) is interpreted as a call with the default dictionary present, which, in the above algorithm, indicates end-of-candidates for all media descriptions and ICE candidate generation. This is by design for legacy reasons.
zh:NOTE:由于WebIDL处理，addIceCandidate（null）被解释为具有默认字典的调用，在上述算法中，该字典指示所有媒体描述和ICE候选生成的候选结束。这是出于遗留原因的设计。

`getDefaultIceServers`

Returns a list of ICE servers that are configured into the browser. A browser might be configured to use local or private STUN or TURN servers. This method allows an application to learn about these servers and optionally use them.
zh:返回配置到浏览器中的ICE服务器列表。浏览器可能配置为使用本地或私有STUN或TURN服务器。此方法允许应用程序了解这些服务器并可选择使用它们。

This list is likely to be persistent and is the same across origins. It thus increases the fingerprinting surface of the browser. In privacy-sensitive contexts, browsers can consider mitigations such as only providing this data to whitelisted origins (or not providing it at all.)
zh:此列表可能是持久的，并且在起源之间是相同的。因此，它增加了浏览器的指纹表面。在隐私敏感的上下文中，浏览器可以考虑缓解，例如仅将此数据提供给白名单来源（或根本不提供）。

NOTE:Since the use of this information is left to the discretion of application developers, configuring a user agent with these defaults does not per se increase a user's ability to limit the exposure of their IP addresses.
zh:NOTE:由于此信息的使用由应用程序开发人员自行决定，因此使用这些默认值配置用户代理本身并不会增加用户限制其IP地址暴露的能力。

`getConfiguration`

Returns an RTCConfiguration object representing the current configuration of this RTCPeerConnection object.
zh:返回表示此RTCPeerConnection对象的当前配置的RTCConfiguration对象。

When this method is called, the user agent MUST return the RTCConfiguration object stored in the [[Configuration]] internal slot.
zh:调用此方法时，用户代理必须返回存储在[[Configuration]]内部插槽中的RTCConfiguration对象。

`setConfiguration`

The setConfiguration method updates the configuration of this RTCPeerConnection object. This includes changing the configuration of the ICE Agent. As noted in [JSEP] (section 3.5.1.), when the ICE configuration changes in a way that requires a new gathering phase, an ICE restart is required.
zh:setConfiguration方法更新此RTCPeerConnection对象的配置。这包括更改ICE代理的配置。如[JSEP]（第3.5.1节）中所述，当ICE配置以需要新收集阶段的方式更改时，需要重新启动ICE。

When the setConfiguration method is invoked, the user agent MUST run the following steps:
zh:调用setConfiguration方法时，用户代理必须运行以下步骤：

1. Let connection be the RTCPeerConnection on which the method was invoked.
zh: 让connection成为调用方法的RTCPeerConnection。

2. If connection's [[IsClosed]] slot is true, throw an InvalidStateError.
zh: 如果connection的[[IsClosed]]槽为true，则抛出InvalidStateError。

3. Set the configuration specified by configuration.
zh: 设置配置指定的配置。

`close`

When the close method is invoked, the user agent MUST run the following steps:
zh:当调用close方法时，用户代理必须运行以下步骤：

1. Let connection be the RTCPeerConnection object on which the method was invoked.
zh: 让connection成为调用方法的RTCPeerConnection对象。

2. If connection's [[IsClosed]] slot is true, abort these steps.
zh: 如果connection的[[IsClosed]]插槽为true，则中止这些步骤。

3. Set connection's [[IsClosed]] slot to true.
zh: 将连接的[[IsClosed]]插槽设置为true。

4. Set connection's signaling state to "closed".
zh: 将连接的信令状态设置为“关闭”。

5. Let transceivers be the result of executing the CollectTransceivers algorithm. For every RTCRtpTransceiver transceiver in transceivers, run the following steps:
zh:让收发器成为执行CollectTransceivers算法的结果。对于收发器中的每个RTCRtpTransceiver收发器，请运行以下步骤：

	1. If transceiver's [[Stopped]] slot is true, abort these steps.
zh: 如果收发器的[[已停止]]插槽为真，则中止这些步骤。

	2. Let sender be transceiver's [[Sender]].
zh: 让发送者成为收发器的[[发件人]]。

	3. Let receiver be transceiver's [[Receiver]].
zh: 让接收器成为收发器的[[接收器]]。

	4. Stop sending media with sender.
zh: 停止向发件人发送媒体。

	5. Send an RTCP BYE for each RTP stream that was being sent by sender, as specified in [RFC3550].
zh: 按照[RFC3550]中的规定，为发送方发送的每个RTP流发送RTCP BYE。

	6. Stop receiving media with receiver.
zh: 停止使用接收器接收媒体。

	7. Set the readyState of receiver's [[ReceiverTrack]] to "ended".
zh: 将接收者的[[ReceiverTrack]]的readyState设置为“ends”。

	8. Set transceiver's [[Stopped]] slot to true.
zh: 将收发器的[[Stopped]]插槽设置为true。

6. Set the [[ReadyState]] slot of each of connection's RTCDataChannels to "closed"
zh: 将每个连接的RTCDataChannels的[[ReadyState]]插槽设置为“closed”。

	NOTE:The RTCDataChannels will be closed abruptly and the closing procedure will not be invoked.
zh：RTCDataChannels将突然关闭，并且不会调用关闭过程。

7. If the connection's [[SctpTransport]] is not null, tear down the underlying SCTP association by sending an SCTP ABORT chunk and set the [[SctpTransportState]] to "closed". 
zh: 如果连接的[[SctpTransport]]不为null，则通过发送SCTP ABORT块并将[[SctpTransportState]]设置为“closed”来拆除底层SCTP关联。

8. Set the [[DtlsTransportState]] slot of each of connection's RTCDtlsTransports to "closed". 
zh: 将每个连接的RTCDtlsTransports的[[DtlsTransportState]]槽设置为“已关闭”。

9. Destroy connection's ICE Agent, abruptly ending any active ICE processing and releasing any relevant resources (e.g. TURN permissions). 
zh: 销毁连接的ICE代理，突然结束任何活动的ICE处理并释放任何相关资源（例如TURN权限）。

10. Set the [[IceTransportState]] slot of each of connection's RTCIceTransports to "closed". 
zh: 将每个连接的RTCIceTransports的[[IceTransportState]]插槽设置为“已关闭”。

11. Set connection's ICE connection state to "closed". 
zh: 将连接的ICE连接状态设置为“已关闭”。

12. Set connection's connection state to "closed". 
zh: 将连接的连接状态设置为“已关闭”。


